{% extends "layout.html" %}
{% block title %}Change Password{% endblock %}

{% block head_extra %}
<style>
    .form-input {
        background-color: rgba(31, 41, 55, 0.7) !important;
        border: 1px solid #374151 !important;
    }
    .form-input:focus {
        border-color: #10b981 !important;
        box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.4) !important;
        outline: none !important;
    }
    /* Added error text style from the register page */
    .error-text {
        color: #ef4444; /* Tailwind's red-500 */
        font-size: 0.875rem; /* text-sm */
        text-align: center;
        margin-top: 1rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-md w-full space-y-8 bg-gray-900/50 border border-gray-700 p-8 md:p-10 rounded-2xl">
        <div>
            <h2 class="mt-6 text-center text-3xl font-extrabold text-white">
                Change Your Password
            </h2>
        </div>
        <form class="mt-8 space-y-6" id="change-password-form" action="{{ url_for('change_password') }}" method="POST">
            <div class="rounded-md shadow-sm space-y-4">
                <div>
                    <label for="current_password" class="sr-only">Current Password</label>
                    <input id="current_password" name="current_password" type="password" required class="appearance-none relative block w-full px-3 py-3 border text-white placeholder-gray-400 sm:text-sm rounded-md form-input" placeholder="Current Password">
                </div>
                <div>
                    <label for="new_password" class="sr-only">New Password</label>
                    <input id="new_password" name="new_password" type="password" required class="appearance-none relative block w-full px-3 py-3 border text-white placeholder-gray-400 sm:text-sm rounded-md form-input" placeholder="New Password">
                </div>
                <div>
                    <label for="confirm_password" class="sr-only">Confirm New Password</label>
                    <input id="confirm_password" name="confirm_password" type="password" required class="appearance-none relative block w-full px-3 py-3 border text-white placeholder-gray-400 sm:text-sm rounded-md form-input" placeholder="Confirm New Password">
                </div>
            </div>

            <div id="error-message" class="error-text"></div>

            <div>
                <button type="submit" class="group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-emerald-600 hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-emerald-500 cta-button">
                    Update Password
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Adapted to use the IDs from this page's form
        const form = document.getElementById('change-password-form');
        const passwordInput = document.getElementById('new_password');
        const confirmPasswordInput = document.getElementById('confirm_password');
        const errorMessageDiv = document.getElementById('error-message');

        form.addEventListener('submit', function(event) {
            errorMessageDiv.textContent = '';

            const password = passwordInput.value;
            const confirmPassword = confirmPasswordInput.value;

            // 1. Check if passwords match
            if (password !== confirmPassword) {
                event.preventDefault();
                errorMessageDiv.textContent = 'New passwords do not match.';
                return;
            }

            // 2. Check for at least one uppercase letter
            if (!/[A-Z]/.test(password)) {
                event.preventDefault();
                errorMessageDiv.textContent = 'Password must contain at least one uppercase letter.';
                return;
            }

            // 3. Check for at least one numeric digit
            if (!/[0-9]/.test(password)) {
                event.preventDefault();
                errorMessageDiv.textContent = 'Password must contain at least one number.';
                return;
            }

            // 4. Check for at least one special character
            if (!/[!@#$%^&*(),.?":{}|<>]/.test(password)) {
                event.preventDefault();
                errorMessageDiv.textContent = 'Password must contain at least one special character.';
                return;
            }
        });
    });
</script>
{% endblock %}